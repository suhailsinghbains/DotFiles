'use strict';var Gka={TAB:0,Mj:1,cn:2},Y$=function(a){Bb("MediaRouter.WebRtc.Start.Success",a,Gka)};var Z$=function(a,b){Kg.call(this,b);this.w=a;this.g=new Cb;this.b=ow(b.id);this.l=new Cb;this.B=!1;this.o=null;this.u=!1;this.A=this.h=null;Hka(this);Ika(this);this.b.sendMessage(new Qg("GET_TURN_CREDENTIALS"))};n(Z$,Kg);
Z$.prototype.start=function(a){var b=this;return this.g.b.then(function(c){if(c.b)return Promise.reject(new Nf("Mirroring already started"));if(b.o)return Promise.reject(new Nf("Session permanently stopped"));b.h=new rb("MediaRouter.WebRtc.Session.Launch");c.Z.addStream(a);c.start();return b.l.b})};
Z$.prototype.stop=function(){var a=this;this.l.reject(new Nf("Session stop requested."));this.A&&(this.A.b(),this.A=null);if(this.o)return this.o;this.u=this.B=!1;this.h=null;return this.o=this.g.b.then(function(a){a.stop()}).then(function(){return a.b.Ua()}).catch(function(b){a.b.Ua();throw b;})};
var Hka=function(a){a.b.onMessage=function(b){if(!b.type)throw Error("Message has no type.");switch(b.type){case "TURN_CREDENTIALS":a.g.resolve(new Vg(a.f.id,b.data.credentials));break;case "ANSWER":a.g.b.then(function(a){ch(a,b.data)});break;case "KNOCK_ANSWER":a.u=!0;a.g.b.then(function(a){ch(a,b.data)});break;case "STOP":a.l.reject(new Nf("Stop signal received"));a.stop();break;default:throw new Nf("Unknown message type: "+b.type);}}},Ika=function(a){a.g.b.then(function(b){Zg(b,function(b){a.b.sendMessage(new Qg("OFFER",
new Sg(b,a.w,Tg)))});$g(b,function(b){b=Rg(b);a.b.sendMessage(b)});Wg(b,function(){a.B=!0;a.b.sendMessage(new Qg("SESSION_START_SUCCESS"));!a.u&&a.h&&a.h.b();a.h=null;a.A=new xb("MediaRouter.WebRtc.Session.Length");a.l.resolve(a)});Yg(b,function(){a.b.sendMessage(new Qg("SESSION_END"))});Xg(b,function(b){a.B||a.l.reject(b);a.b.sendMessage(new Qg("SESSION_FAILURE"))})})};var $$=function(){zg.call(this,"webrtc")};n($$,zg);g=$$.prototype;g.eh=function(a,b){return new Z$(a,b)};g.Fg=function(){Y$(0)};g.Cg=function(){Y$(1)};g.Hh=function(){Y$(2)};g.Dg=function(){Ab("MediaRouter.WebRtc.Session.End")};g.Gh=function(a){Bb("MediaRouter.WebRtc.Start.Failure",a,Mf)};g.Eg=function(){Ab("MediaRouter.WebRtc.Stream.End")};var Jka=new $$;og("mr.mirror.webrtc.WebRtcService",Jka);
